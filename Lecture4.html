

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>4. Materials Data and Representations &#8212; Machine Learning for Materials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-74ZFK336GP"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-74ZFK336GP');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Lecture4';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="3. Machine Learning Basics" href="Lecture3.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="Overview.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Machine Learning for Materials - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Machine Learning for Materials - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="Overview.html">
                    Overview
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Details</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Contents.html">Course Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="Learning.html">Learning Outcomes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Resources.html">Resources</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Notebooks</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Lecture1.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture2.html">2. Materials Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lecture3.html">3. Machine Learning Basics</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">4. Materials Data and Representations</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/aronwalsh/MLforMaterials/main?urlpath=tree/Lecture4.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/aronwalsh/MLforMaterials/blob/main/Lecture4.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/aronwalsh/MLforMaterials" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/aronwalsh/MLforMaterials/issues/new?title=Issue%20on%20page%20%2FLecture4.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Lecture4.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Materials Data and Representations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chemical-space">4.1. 🚀 Chemical space</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminary-steps">4.1.1. Preliminary steps</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#database-access">4.2. Database access</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-by-properties">4.2.1. Filter by properties</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chemical-space-of-metal-oxides">4.3. Chemical space of metal oxides</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#query-for-metal-oxides">4.3.1. Query for metal oxides</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unsupervised-machine-learning">4.4. Unsupervised machine learning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-metal-oxide-perovskites">4.5. 🚨 Exercise 4: Metal oxide perovskites</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#your-details">4.5.1. Your details</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tasks">4.5.2. Tasks</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dive-deeper">4.6. 🌊 Dive deeper</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="materials-data-and-representations">
<h1><span class="section-number">4. </span>Materials Data and Representations<a class="headerlink" href="#materials-data-and-representations" title="Permalink to this heading">#</a></h1>
<div class="tip admonition">
<p class="admonition-title">Michael Ashby and David Jones</p>
<p>How is the engineer to choose from this vast menu the material that best suits the purpose?</p>
</div>
<iframe class="speakerdeck-iframe" frameborder="0" src="https://speakerdeck.com/player/431daa62140b472bb2b19c499ebb73f5" title="Machine Learning for Materials (Lecture 4)" allowfullscreen="true" style="border: 0px; background-clip: padding-box; background-color: rgba(0, 0, 0, 0.1); margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 420;" data-ratio="1.3333333333333333"></iframe>
<p><a class="reference external" href="https://speakerdeck.com/aronwalsh/mlformaterials-lecture4-data">Lecture slides</a></p>
<section id="chemical-space">
<h2><span class="section-number">4.1. </span>🚀 Chemical space<a class="headerlink" href="#chemical-space" title="Permalink to this heading">#</a></h2>
<p>Our world can be described as a three-dimensional space (or a four-dimensional continuum if you consider spacetime). Chemical space is even more vast when you think of all of the compositions and structures that can be built from combinations of the 118 elements in the Periodic Table! Even considering only carbon atoms, C-C bonds can be used to form molecules, rods, spheres, sheets, and extended crystals.</p>
<p>The goal today is to access, filter, and visualise data from <a class="reference external" href="https://materialsproject.org">Materials Project</a>. This is one of the growing number of computational materials science databases that includes <a class="reference external" href="https://nomad-lab.eu">NOMAD</a>, <a class="reference external" href="https://oqmd.org">OQMD</a>, and <a class="reference external" href="http://www.aflowlib.org">AFLOW</a>. We will use an application programming interface (API) via Python.</p>
<details>
<summary> Data warning </summary>
Most computational databases are based on the properties of static crystals. In reality, temperature influences the structures and properties of crystals. We have to start somewhere, but keep this in mind when judging the utility of derived models.
</details>
<section id="preliminary-steps">
<h3><span class="section-number">4.1.1. </span>Preliminary steps<a class="headerlink" href="#preliminary-steps" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Create an account for the <a class="reference external" href="https://materialsproject.org">Materials Project site</a></p></li>
<li><p>Get your API access key from the <a class="reference external" href="https://materialsproject.org/dashboard">dashboard</a> to access the database via Python</p></li>
<li><p>You must paste your unique API key below</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Installation of libraries</span>
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pymatgen<span class="w"> </span>--quiet
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mp-api<span class="w"> </span>--quiet
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>elementembeddings<span class="w"> </span>--quiet
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import of modules</span>
<span class="kn">from</span> <span class="nn">mp_api.client</span> <span class="kn">import</span> <span class="n">MPRester</span>  <span class="c1"># Materials Project API client</span>
<span class="kn">import</span> <span class="nn">pprint</span>  <span class="c1"># Pretty print data structures</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>  <span class="c1"># Data manipulation with DataFrames</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>  <span class="c1"># Numerical operations</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>  <span class="c1"># Plotting</span>
<span class="kn">import</span> <span class="nn">os</span>  <span class="c1"># Operating system functions</span>

<span class="c1"># Assign your API key to the variable below</span>
  <span class="c1"># i.e. paste the key in between the quotation marks</span>
<span class="n">API_KEY</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="c1"># @param {type:&quot;string&quot;}</span>
</pre></div>
</div>
</div>
</div>
<details>
<summary>Colab error solution</summary>
If running the import module cell fails with an "AttributeError", click `Runtime` -> `Restart Session` and then simply rerun the cell. </section>
</section>
<section id="database-access">
<h2><span class="section-number">4.2. </span>Database access<a class="headerlink" href="#database-access" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">MPRester</span></code> serves as a Python client to accessing the data contained in the Materials Project. The typical way to use it is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">MPRester</span><span class="p">(</span><span class="n">API_KEY</span><span class="p">)</span> <span class="k">as</span> <span class="n">mpr</span><span class="p">:</span>
    <span class="c1"># do something</span>
</pre></div>
</div>
<p>You may have encountered the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement when reading or writing to files. We use the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement here for our queries.  It is a context manager that, to summarise, manages resources.</p>
<p>The database can be queried by Material Project ID(s) and/or specific materials properties. For this exercise, we will access data through the <code class="docutils literal notranslate"><span class="pre">summary</span></code> API endpoint. This can be queried using the <code class="docutils literal notranslate"><span class="pre">search</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Query for two materials by their Material Project IDs</span>
<span class="k">with</span> <span class="n">MPRester</span><span class="p">(</span><span class="n">API_KEY</span><span class="p">)</span> <span class="k">as</span> <span class="n">mpr</span><span class="p">:</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="n">mpr</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">material_ids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mp-1069538&#39;</span><span class="p">,</span><span class="s1">&#39;mp-540839&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<details>
<summary> Code hint </summary>
If the cell fails, check that your API_KEY has no spaces before or after the string</details>
<p>Using the <code class="docutils literal notranslate"><span class="pre">search</span></code> method results in a list of <code class="docutils literal notranslate"><span class="pre">MPDataDoc</span></code> objects being returned. The properties of each material in the query are accessible as attributes of the object. Run the cell block below to access some of the properties from the first result of our query.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display some properties of the first material from our query</span>
<span class="n">first_doc</span> <span class="o">=</span> <span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The Materials Project ID is </span><span class="si">{</span><span class="n">first_doc</span><span class="o">.</span><span class="n">material_id</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The chemical formula is </span><span class="si">{</span><span class="n">first_doc</span><span class="o">.</span><span class="n">formula_pretty</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The band gap is </span><span class="si">{</span><span class="n">first_doc</span><span class="o">.</span><span class="n">band_gap</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> eV</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The crystal system is </span><span class="si">{</span><span class="n">first_doc</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">crystal_system</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The energy above the convex hull (EATCH) is </span><span class="si">{</span><span class="n">first_doc</span><span class="o">.</span><span class="n">energy_above_hull</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> eV/atom&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The Materials Project contains many materials properties. The cell above is only a small snapshot of those accessible from the <code class="docutils literal notranslate"><span class="pre">summary</span></code> endpoint. Run the cell below to see the full range of properties that are available.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run this cell to see the full list of available properties</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mpr</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">available_fields</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>By default, all fields are returned when we perform a query. Let’s investigate the <code class="docutils literal notranslate"><span class="pre">MPDataDoc</span></code> object a bit further.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print the first query result</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_doc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As all available fields have been requested, the object is lengthy.</p>
<p>Each property field is accessible as an attribute of the <code class="docutils literal notranslate"><span class="pre">MPDataDoc</span></code> object. Some are equal to <code class="docutils literal notranslate"><span class="pre">None</span></code> as that property is not available for that material. If there are certain properties that we are interested in, we can pass a <code class="docutils literal notranslate"><span class="pre">fields</span></code> argument to the <code class="docutils literal notranslate"><span class="pre">search</span></code> method and specify those fields we want returned. For example, if we were only interested in:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">material_id</span></code> (the Materials Project ID)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">band_gap</span></code> (the electronic band gap - the difference in energy between the valence band and conduction band)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">structure</span></code> (the crystal structure information)</p></li>
<li><p>if the material is <code class="docutils literal notranslate"><span class="pre">theoretical</span></code> (not recorded in the Inorganic Crystal Structure Database)</p></li>
<li><p>if the material <code class="docutils literal notranslate"><span class="pre">is_stable</span></code> (defined as the material having an energy above the thermodynamic convex hull of 0 eV/atom)</p></li>
</ul>
<p>then we would pass the following argument into the <code class="docutils literal notranslate"><span class="pre">search</span></code> method: <code class="docutils literal notranslate"><span class="pre">fields=[&quot;material_id&quot;,</span> <span class="pre">&quot;band_gap&quot;,</span> <span class="pre">&quot;structure&quot;,</span> <span class="pre">&quot;theoretical&quot;,</span> <span class="pre">&quot;is_stable&quot;]</span></code>.</p>
<section id="filter-by-properties">
<h3><span class="section-number">4.2.1. </span>Filter by properties<a class="headerlink" href="#filter-by-properties" title="Permalink to this heading">#</a></h3>
<p>We can also query by property value. This can be useful in searching for materials which meet particular property requirements. Using the <code class="docutils literal notranslate"><span class="pre">search</span></code> method, we would provide the property as an argument. To query for materials with <code class="docutils literal notranslate"><span class="pre">band_gap</span></code> greater than 0.5 eV but less than 1.5 eV, we pass the following argument to the <code class="docutils literal notranslate"><span class="pre">search</span></code> method: <code class="docutils literal notranslate"><span class="pre">band_gap=(0.5,1.5)</span></code>.</p>
<p>Let’s run some code to demonstrate these queries. We will first try to search for some semiconducting binary and ternary oxides by querying for materials with:</p>
<ul class="simple">
<li><p>a band gap between 0.5 and 1.5 eV: <code class="docutils literal notranslate"><span class="pre">band_gap=(0.5,1.5)</span></code></p></li>
<li><p>two elements: <code class="docutils literal notranslate"><span class="pre">num_elements=(2,3)</span></code></p></li>
<li><p>contains lithium: <code class="docutils literal notranslate"><span class="pre">elements=[&quot;Li&quot;]</span></code></p></li>
</ul>
<p>We want to return the following properties: <code class="docutils literal notranslate"><span class="pre">material_id</span></code>,<code class="docutils literal notranslate"><span class="pre">formula_pretty</span></code> ,<code class="docutils literal notranslate"><span class="pre">band_gap</span></code>, <code class="docutils literal notranslate"><span class="pre">theoretical</span></code>, <code class="docutils literal notranslate"><span class="pre">is_stable</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Query for binary and ternary Li compounds with compact output</span>
<span class="k">with</span> <span class="n">MPRester</span><span class="p">(</span><span class="n">FBI_KEY</span><span class="p">,</span> <span class="n">use_document_model</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">mpr</span><span class="p">:</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="n">mpr</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">elements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Li&quot;</span><span class="p">],</span>
        <span class="n">band_gap</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span>
        <span class="n">num_elements</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;material_id&#39;</span><span class="p">,</span> <span class="s1">&#39;formula_pretty&#39;</span><span class="p">,</span><span class="s1">&#39;band_gap&#39;</span><span class="p">,</span><span class="s1">&#39;is_stable&#39;</span><span class="p">,</span> <span class="s1">&#39;theoretical&#39;</span><span class="p">]</span>
       <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of binary and ternary Li containing compounds with a band gap between 0.5 and 1.5 eV: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<details>
<summary> Code hint </summary>
MPRester needs API_KEY as input, not FBI_KEY. Replace!
</details><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert the list of dictionaries into a DataFrame</span>
<span class="n">docs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Display the first few rows of the DataFrame</span>
<span class="n">docs_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
</pre></div>
</div>
</div>
</div>
<details>
<summary> Code hint </summary>
Check that all brackets are closed...
</details><p>By converting the query data into a DataFrame, we have access to efficient methods to summarise the data. For example, we can use <code class="docutils literal notranslate"><span class="pre">.describe()</span></code> for summary statistics for the numerical columns. Run the cell below to see the summary statistics for the numerical columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get summary statistics for the numerical columns in the DataFrame</span>
<span class="n">docs_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>It is important when querying any form of database that we know (and keep a record of) the database version. We can check this through the API using the <code class="docutils literal notranslate"><span class="pre">.get_database_version()</span></code> method as shown below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Confirm database version</span>
<span class="n">db_version</span> <span class="o">=</span> <span class="n">mpr</span><span class="o">.</span><span class="n">get_database_version</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;We have been querying the </span><span class="si">{</span><span class="n">db_version</span><span class="si">}</span><span class="s1"> version of the Materials Project.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="chemical-space-of-metal-oxides">
<h2><span class="section-number">4.3. </span>Chemical space of metal oxides<a class="headerlink" href="#chemical-space-of-metal-oxides" title="Permalink to this heading">#</a></h2>
<p>Now that we have an understanding of the API, let’s find some metal oxides. The workflow will involve the following steps:</p>
<ul class="simple">
<li><p>Query for metal oxides</p></li>
<li><p>Visualise the distribution of the number of elements in each material</p></li>
</ul>
<p>Note that there is no one fixed way of obtaining the results. Like Python programming, the use of API queries is flexible and leaves room for personal preference and creativity.</p>
<section id="query-for-metal-oxides">
<h3><span class="section-number">4.3.1. </span>Query for metal oxides<a class="headerlink" href="#query-for-metal-oxides" title="Permalink to this heading">#</a></h3>
<p>We can query for all the oxygen-containing materials using the <code class="docutils literal notranslate"><span class="pre">elements</span></code> argument and setting it to <code class="docutils literal notranslate"><span class="pre">[&quot;O&quot;]</span></code>. We can also specify the number of elements in the material by using the <code class="docutils literal notranslate"><span class="pre">num_elements</span></code> argument. We will set this to <code class="docutils literal notranslate"><span class="pre">(2,3)</span></code> to specify that we want materials with 2-3 elements. We will also specify the properties that we want returned by using the <code class="docutils literal notranslate"><span class="pre">fields</span></code> argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This may take two minutes to run - be patient!</span>

<span class="c1"># Query for binary and ternary oxides</span>
<span class="k">with</span> <span class="n">MPRester</span><span class="p">(</span><span class="n">API_KEY</span><span class="p">,</span> <span class="n">use_document_model</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">mpr</span><span class="p">:</span>
    <span class="n">oxide_docs</span> <span class="o">=</span> <span class="n">mpr</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">elements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">],</span>
        <span class="n">num_elements</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;material_id&#39;</span><span class="p">,</span><span class="s1">&#39;formula_pretty&#39;</span><span class="p">,</span><span class="s1">&#39;elements&#39;</span><span class="p">,</span><span class="s1">&#39;nelements&#39;</span><span class="p">,</span><span class="s1">&#39;formula_anonymous&#39;</span><span class="p">,</span><span class="s1">&#39;symmetry.number&#39;</span><span class="p">,</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span><span class="s1">&#39;formation_energy_per_atom&#39;</span><span class="p">,</span><span class="s1">&#39;band_gap&#39;</span><span class="p">]</span>
       <span class="p">)</span>
    
<span class="c1"># Convert the query results into a DataFrame</span>
<span class="n">oxide_df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">oxide_docs</span><span class="p">)</span>

<span class="c1"># Display the first few rows of the DataFrame</span>
<span class="n">oxide_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We now have a DataFrame with the properties that we requested. However, the symmetry is still in dictionary form. This type of issue arises many times in data pre-processing for machine learning models.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">symmetry</span></code> property contains key value pairs  of the symmetry data. We can convert the <code class="docutils literal notranslate"><span class="pre">symmetry</span></code> into a column of the DataFrame using <code class="docutils literal notranslate"><span class="pre">.apply()</span></code>. This method applies a function to each row of the DataFrame. In this case, we will apply a function that returns the value of the <code class="docutils literal notranslate"><span class="pre">number</span></code> key of the <code class="docutils literal notranslate"><span class="pre">symmetry</span></code> dictionary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert the symmetry property into a column of the DataFrame called &quot;symmetry.number&quot;</span>

<span class="c1"># Define a function that returns the value of the &quot;number&quot; key of the &quot;symmetry&quot; dictionary</span>
<span class="k">def</span> <span class="nf">get_spacegroup_number</span><span class="p">(</span><span class="n">symmetry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the value of the &quot;number&quot; key of the &quot;symmetry&quot; dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">symmetry</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span>

<span class="c1"># Apply the function to each row of the DataFrame</span>
<span class="n">oxide_df</span><span class="p">[</span><span class="s2">&quot;symmetry.number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oxide_df</span><span class="p">[</span><span class="s2">&quot;symmetry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_spacegroup_number</span><span class="p">)</span>

<span class="c1"># Drop the &quot;symmetry&quot; column from the DataFrame</span>
<span class="n">oxide_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;symmetry&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Display the first few rows of the DataFrame</span>
<span class="n">oxide_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We now have a DataFrame populated with properties. Let’s visualise the number of components.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualise the distribution of the number of elements in each material</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Counts of components</span>
<span class="n">component_count</span> <span class="o">=</span> <span class="n">oxide_df</span><span class="o">.</span><span class="n">nelements</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

<span class="c1"># Create a color map based on the number of elements</span>
  <span class="c1"># We will use the number of elements as the color value</span>
<span class="n">color_map</span> <span class="o">=</span> <span class="n">component_count</span><span class="o">.</span><span class="n">index</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Apply the color map to the bars</span>
<span class="n">bars</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">component_count</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">component_count</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">(</span><span class="n">color_map</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of elements&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of materials&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar_label</span><span class="p">(</span><span class="n">bars</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">component_count</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">component_count</span><span class="o">.</span><span class="n">index</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
</pre></div>
</div>
</div>
</div>
<details>
<summary> Code hint </summary>
Remember to close your brackets
</details></section>
</section>
<section id="unsupervised-machine-learning">
<h2><span class="section-number">4.4. </span>Unsupervised machine learning<a class="headerlink" href="#unsupervised-machine-learning" title="Permalink to this heading">#</a></h2>
<p>We have a set of materials with different compositions and crystal structures. We can use a machine learning technique to visualise these in two-dimensions. You can of this like a materials map. We refer to the methods that enable us to reduce high-dimensional data into lower dimensions as dimension reduction techniques. These allow us to visualise complex data and in this example we will make use of Principal Component Analysis (PCA).</p>
<details>
<summary> Overview of PCA </summary>
PCA is a popular technique for dimension reduction and data preprocessing, enabling the simplification of complex datasets while retaining crucial information. High-dimensional data is transformed into a new coordinate system where the axes align with the directions of maximum variance in the original data. These new axes, termed "principal components," are orthogonal. The first principal component captures the highest variance, the second captures the second highest, etc.
<p><em>Key use cases include:</em></p>
<ul class="simple">
<li><p><strong>Dimensionality Reduction</strong>: Identifying and eliminating less informative dimensions, reducing noise and computational complexity.</p></li>
<li><p><strong>Data Visualisation</strong>: Facilitating easier interpretation while preserving essential patterns.</p></li>
<li><p><strong>Noise Reduction</strong>: Filtering out noise or unimportant variations by focusing on significant variance.</p></li>
<li><p><strong>Feature Engineering</strong>: A preprocessing step to transform data before applying machine learning algorithms, potentially improving performance.</p></li>
</ul>
<p><em>PCA workflow:</em></p>
<ol class="arabic">
<li><p><strong>Center the Data</strong>: Subtract the mean from each feature to center the data around the origin.</p>
<p><span class="math notranslate nohighlight">\(
X_{\text{centered}} = X - \bar{X}
\)</span></p>
</li>
<li><p><strong>Calculate Covariance Matrix</strong>: Compute the covariance matrix to understand feature relationships and their <a class="reference external" href="https://en.wikipedia.org/wiki/Covariance">covariance</a>.</p>
<p><span class="math notranslate nohighlight">\(
\text{Cov}(X) = \frac{1}{n}X_{\text{centered}}^T X_{\text{centered}}
\)</span></p>
</li>
<li><p><strong>Compute Eigenvalues and Eigenvectors</strong>: Calculate eigenvalues (<span class="math notranslate nohighlight">\(\lambda_i\)</span>) and eigenvectors (<span class="math notranslate nohighlight">\(\mathbf{v}_i\)</span>) of the covariance matrix. Eigenvectors represent maximum variance directions, and eigenvalues quantify the variance magnitude.</p>
<p><span class="math notranslate nohighlight">\(
\text{Cov}(X) \mathbf{v}_i = \lambda_i \mathbf{v}_i
\)</span></p>
</li>
<li><p><strong>Sort Eigenvalues</strong>: Sort eigenvalues in descending order, rearranging corresponding eigenvectors accordingly.</p></li>
<li><p><strong>Select Principal Components</strong>: Choose a subset of eigenvectors (principal components) based on eigenvalues, explaining the most variance in the data.</p></li>
<li><p><strong>Project Data</strong>: Project original data onto selected principal components, yielding a lower-dimensional representation.</p></li>
</ol>
<p>Note that PCA analysis is limited by its reliance on linear transformations of the data. In cases where non-linear structures are prominent, alternative techniques such as t-distributed Stochastic Neighbor Embedding (t-SNE) can be used.</p>
</details><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform PCA analysis</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="c1"># Random 10D vectors for demonstration purposes</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">num_samples</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">dimensionality</span> <span class="o">=</span> 
<span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">dimensionality</span><span class="p">)</span>

<span class="c1"># Perform PCA to reduce the dimensionality to 2D</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">dimensionality</span><span class="p">)</span>
<span class="n">reduced_data</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Create a color map based on the original data points</span>
   <span class="c1"># Use the first dimension of the original data as the color value</span>
<span class="n">color_map</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

<span class="c1"># Plot the 2D projection</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">reduced_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">reduced_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Colour based on first dimension&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Principal Component 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Principal Component 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;2D projection using PCA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<details>
<summary> Code hint </summary>
Set the number of components to 2
</details><p>Using our dataset, we can try different featurisation schemes and analyse the resulting visualisations. Here we will perform a simple “one-hot encoding” of the chemical compositions using the <a class="reference external" href="https://github.com/WMD-group/ElementEmbeddings">ElementEmbeddings</a> package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will take a minute or two to run - be patient! </span>

<span class="c1"># Featurise to create compositional vectors</span>
<span class="kn">from</span> <span class="nn">elementembeddings.composition</span> <span class="kn">import</span> <span class="n">composition_featuriser</span>
<span class="n">oxide_onehot_df</span> <span class="o">=</span> <span class="n">composition_featuriser</span><span class="p">(</span><span class="n">oxide_df</span><span class="p">,</span> <span class="n">formula_column</span><span class="o">=</span><span class="s2">&quot;formula_pretty&quot;</span><span class="p">,</span> <span class="n">embedding</span><span class="o">=</span><span class="s2">&quot;atomic&quot;</span><span class="p">,</span><span class="n">stats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">])</span>
<span class="n">oxide_onehot_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform PCA analysis using the oxide feature set</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">elementembeddings.composition</span> <span class="kn">import</span> <span class="n">composition_featuriser</span>

<span class="c1"># Define columns to drop from the dataset</span>
<span class="n">cols_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;elements&quot;</span><span class="p">,</span> <span class="s2">&quot;nelements&quot;</span><span class="p">,</span> <span class="s2">&quot;formula_pretty&quot;</span><span class="p">,</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="s2">&quot;formula_anonymous&quot;</span><span class="p">,</span> <span class="s2">&quot;material_id&quot;</span><span class="p">,</span> <span class="s2">&quot;symmetry.number&quot;</span><span class="p">,</span> <span class="s2">&quot;composition&quot;</span><span class="p">,</span><span class="s2">&quot;band_gap&quot;</span><span class="p">,</span> <span class="s2">&quot;formation_energy_per_atom&quot;</span><span class="p">]</span>

<span class="c1"># Create a list of feature columns</span>
<span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">oxide_onehot_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cols_to_drop</span><span class="p">]</span>

<span class="c1"># Extract feature values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">oxide_onehot_df</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="c1"># Alternative featurisation scheme </span>
<span class="c1"># X = oxide_magpie_df[feature_cols].values</span>

<span class="c1"># Standardise the feature values</span>
<span class="n">X_standardised</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Perform PCA to reduce dimensionality to 2D</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">reduced_data</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_standardised</span><span class="p">)</span>

<span class="c1"># Create subplots for visualisation</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Loop through columns for coloring the data points</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="p">[</span><span class="s2">&quot;symmetry.number&quot;</span><span class="p">,</span> <span class="s2">&quot;band_gap&quot;</span><span class="p">]):</span>
    <span class="n">color_map</span> <span class="o">=</span> <span class="n">oxide_onehot_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">reduced_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">reduced_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Component 1&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Component 2&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Adjust layout and display the plot</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<details>
<summary> Code hint </summary>
You can change the featurisation scheme to see the impact on the resulting visualisation and distribution of compositions
</details></section>
<section id="exercise-4-metal-oxide-perovskites">
<h2><span class="section-number">4.5. </span>🚨 Exercise 4: Metal oxide perovskites<a class="headerlink" href="#exercise-4-metal-oxide-perovskites" title="Permalink to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">Coding exercises</p>
<p>The exercises are designed to apply what you have learned with room for creativity. It is fine to discuss solutions with your classmates, but the actual code should not be directly copied.</p>
<p>The completed notebooks are to be submitted at the end of class, but you can revist later, experiment with the code, and follow the further reading suggestions.</p>
</div>
<section id="your-details">
<h3><span class="section-number">4.5.1. </span>Your details<a class="headerlink" href="#your-details" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Insert your values</span>
<span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;No Name&quot;</span> <span class="c1"># Replace with your name</span>
<span class="n">CID</span> <span class="o">=</span> <span class="mi">123446</span> <span class="c1"># Replace with your College ID (as a numeric value with no leading 0s)</span>

<span class="c1"># Set a random seed using the CID value</span>
<span class="n">CID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">CID</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">CID</span><span class="p">)</span>

<span class="c1"># Print the message</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is the work of &quot;</span> <span class="o">+</span> <span class="n">Name</span> <span class="o">+</span> <span class="s2">&quot; [CID: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="tasks">
<h3><span class="section-number">4.5.2. </span>Tasks<a class="headerlink" href="#tasks" title="Permalink to this heading">#</a></h3>
<p>We have covered a lot today. You can revisit and tweak the examples in your own time, as well as consult the <code class="docutils literal notranslate"><span class="pre">pymatgen</span></code> manual.</p>
<p>There is one task to complete:</p>
<ol class="arabic simple">
<li><p>Investigate how many cubic ABO<sub>3</sub> perovskite structures exist in your metal oxide dataset. Here is an example that queries for 3 component materials that you can extend.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">abc_df</span> <span class="o">=</span> <span class="n">oxide_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">oxide_df</span><span class="p">[</span><span class="s2">&quot;nelements&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)]</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">abc_df</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; 3 component materials &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oxide_df</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; metal oxides extracted from the database.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Self-study (optional)</em></p>
<ol class="arabic simple" start="2">
<li><p>Plot the occurance of elements A and B in these metal oxide perovskites. Identify which element is present in the most perovskites.</p></li>
<li><p>Within the crystal-chemical space of metal oxides, see if perovskites are clustered into one specific region of the two-dimensional PCA map.</p></li>
</ol>
<details>
<summary> Task hint </summary>
For task 1, remember the spacegroup number of cubic perovskites is 221. You could filter for this with `symmetry.number`.
</details>
<div class="note admonition">
<p class="admonition-title">Submission</p>
<p>When your notebook is complete, click on the download icon on the top right, select <code class="docutils literal notranslate"><span class="pre">.pdf</span></code>, save the file and upload it to MyDepartment. If you are using Google Colab, you have to print to pdf.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Code block </span>


    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Comment block </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Code block </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Comment block </span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="dive-deeper">
<h2><span class="section-number">4.6. </span>🌊 Dive deeper<a class="headerlink" href="#dive-deeper" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><em>Level 1:</em> Tackle Chapter 8 on Linear Unsupervised Learning in <a class="reference external" href="https://github.com/jermwatt/machine_learning_refined#what-is-new-in-the-second-edition">Machine Learning Refined</a>.</p></li>
<li><p><em>Level 2:</em> Read about our attempt to screen <em>all inorganic materials</em> (with caveats) in the journal <a class="reference external" href="https://doi.org/10.1016/j.chempr.2016.09.010">Chem</a>.</p></li>
<li><p><em>Level 3:</em> Watch a <a class="reference external" href="https://www.youtube.com/watch?v=gd-uahI5xbA">seminar</a> by quantum chemist Anatole von Lilienfeld on chemical space.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "aronwalsh/MLforMaterials",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Lecture3.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">3. </span>Machine Learning Basics</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chemical-space">4.1. 🚀 Chemical space</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminary-steps">4.1.1. Preliminary steps</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#database-access">4.2. Database access</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-by-properties">4.2.1. Filter by properties</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chemical-space-of-metal-oxides">4.3. Chemical space of metal oxides</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#query-for-metal-oxides">4.3.1. Query for metal oxides</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unsupervised-machine-learning">4.4. Unsupervised machine learning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-metal-oxide-perovskites">4.5. 🚨 Exercise 4: Metal oxide perovskites</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#your-details">4.5.1. Your details</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tasks">4.5.2. Tasks</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dive-deeper">4.6. 🌊 Dive deeper</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aron Walsh
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>